"""
Answer Rejection System –¥–ª—è Goszakup Bot
–û—Ç–∫–ª–æ–Ω—è–µ—Ç –Ω–µ–Ω–∞–¥–µ–∂–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–º–µ—Å—Ç–æ –Ω–∏—Ö –ø–æ–º–æ—â—å –ø–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º –≤–æ–ø—Ä–æ—Å–∞–º

–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã: –ë–æ—Ç –¥–∞–≤–∞–ª –Ω–µ—Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –æ—Ç–≤–µ—Ç–∞
–¶–µ–ª—å: 100% —Ç–æ—á–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
"""

from enum import Enum
from dataclasses import dataclass
from typing import Tuple, Optional


class AnswerReliability(Enum):
    """–£—Ä–æ–≤–Ω–∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–≤–µ—Ç–∞"""
    HIGHLY_RELIABLE = "highly_reliable"      # >= 0.85
    RELIABLE = "reliable"                    # 0.70-0.84
    QUESTIONABLE = "questionable"            # 0.50-0.69
    UNRELIABLE = "unreliable"                # < 0.50


@dataclass
class RejectionReason:
    """–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞"""
    reason_code: str
    description: str
    confidence_score: float
    recommendation: str


class AnswerRejectionSystem:
    """
    –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –Ω–µ–Ω–∞–¥–µ–∂–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

    –ü—Ä–∞–≤–∏–ª–∞:
    1. –ï—Å–ª–∏ confidence < 0.50 ‚Üí –û–¢–ö–õ–û–ù–ò–¢–¨
    2. –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã critical hallucinations ‚Üí –û–¢–ö–õ–û–ù–ò–¢–¨
    3. –ï—Å–ª–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ ‚Üí –û–¢–ö–õ–û–ù–ò–¢–¨
    4. –ï—Å–ª–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ ‚Üí –û–¢–ö–õ–û–ù–ò–¢–¨
    """

    # –ü–æ—Ä–æ–≥–∏ –ø—Ä–∏–Ω—è—Ç–∏—è –æ—Ç–≤–µ—Ç–æ–≤
    # –£–õ–£–ß–®–ï–ù–û (2026-02-23): –°–Ω–∏–∂–µ–Ω –ø–æ—Ä–æ–≥ —Å 0.50 –¥–æ 0.35 –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –ª–æ–∂–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π
    # –û—Å–Ω–æ–≤–∞–Ω–∏–µ: Answers —Å —è–≤–Ω—ã–º–∏ —Ü–∏—Ç–∞—Ç–∞–º–∏ –∏ –ª–æ–≥–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è –¥–∞–∂–µ —Å confidence 0.30-0.50
    # –°–∏—Å—Ç–µ–º–∞ —É–∂–µ –∏–º–µ–µ—Ç –¥—Ä—É–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (hallucination_prevention, source_coverage) –¥–ª—è –æ—Ç—Å–µ–≤–∞ –ø–ª–æ—Ö–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
    MINIMUM_CONFIDENCE = 0.35
    MEDIUM_CONFIDENCE = 0.70
    HIGH_CONFIDENCE = 0.85

    # –°—Ü–µ–Ω–∞—Ä–∏–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –æ—Ç–∫–∞–∑–∞ (–¥–∞–∂–µ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π confidence)
    CONSULTATION_REQUIRED_SCENARIOS = {
        "vat_amendment": {
            "keywords": ["–ù–î–°", "–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ù–î–°", "–¥–æ–≥–æ–≤–æ—Ä –±–µ–∑ –ù–î–°"],
            "reason": "–¢—Ä–µ–±—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –±—é–¥–∂–µ—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏",
            "department": "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç–¥–µ–ª + –£–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω—ã–π –æ—Ä–≥–∞–Ω"
        },
        "contract_modification": {
            "keywords": ["–∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞", "—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è", "–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—É–º–º—ã"],
            "reason": "–¢—Ä–µ–±—É–µ—Ç –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—É–Ω–∫—Ç—É 2 —Å—Ç.18 –ó–∞–∫–æ–Ω–∞",
            "department": "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª + –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –∑–∞–∫—É–ø–æ–∫"
        },
        "procurement_rules_ambiguity": {
            "keywords": ["–º–æ–∂–µ—Ç –±—ã—Ç—å", "–≤–æ–∑–º–æ–∂–Ω–æ", "–≤–µ—Ä–æ—è—Ç–Ω–æ", "–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ"],
            "reason": "–°–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ —á–µ—Ç–∫–∏—Ö –Ω–æ—Ä–º",
            "department": "–£–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω—ã–π –æ—Ä–≥–∞–Ω –ø–æ –≥–æ—Å–∑–∞–∫—É–ø–∫–∞–º"
        }
    }

    @staticmethod
    def should_reject_answer(
        answer: str,
        confidence: float,
        has_critical_issues: bool,
        is_multiple_interpretations: bool,
        source_coverage: float
    ) -> Tuple[bool, Optional[RejectionReason]]:
        """
        –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç

        Args:
            answer: –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–æ—Ç–∞
            confidence: –£—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (0.0-1.0)
            has_critical_issues: –ï—Å—Ç—å –ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏)
            is_multiple_interpretations: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã—Ö –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–π
            source_coverage: –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–∫—Ä—ã—Ç–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ (0.0-1.0)

        Returns:
            (should_reject: bool, reason: RejectionReason or None)
        """

        # –ü–†–ê–í–ò–õ–û 1: –ù–∏–∑–∫–∞—è confidence ‚Üí –û–¢–ö–õ–û–ù–ò–¢–¨
        if confidence < AnswerRejectionSystem.MINIMUM_CONFIDENCE:
            return True, RejectionReason(
                reason_code="LOW_CONFIDENCE",
                description=f"–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –æ—Ç–≤–µ—Ç–µ —Ç–æ–ª—å–∫–æ {confidence:.0%}",
                confidence_score=confidence,
                recommendation="–ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–º –æ—Ä–≥–∞–Ω–æ–º"
            )

        # –ü–†–ê–í–ò–õ–û 2: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏) ‚Üí –û–¢–ö–õ–û–ù–ò–¢–¨
        if has_critical_issues:
            return True, RejectionReason(
                reason_code="CRITICAL_HALLUCINATIONS",
                description="–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –≤—ã–¥—É–º–∞–Ω–Ω—ã–µ –Ω–æ—Ä–º—ã –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã",
                confidence_score=confidence,
                recommendation="–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ /docs"
            )

        # –ü–†–ê–í–ò–õ–û 3: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ ‚Üí –û–¢–ö–õ–û–ù–ò–¢–¨
        if is_multiple_interpretations:
            return True, RejectionReason(
                reason_code="MULTIPLE_INTERPRETATIONS",
                description="–û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤",
                confidence_score=confidence,
                recommendation="–í–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º"
            )

        # –ü–†–ê–í–ò–õ–û 4: –ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ ‚Üí –û–¢–ö–õ–û–ù–ò–¢–¨
        if source_coverage < 0.70:
            return True, RejectionReason(
                reason_code="INSUFFICIENT_SOURCE_COVERAGE",
                description=f"–¢–æ–ª—å–∫–æ {source_coverage:.0%} –æ—Ç–≤–µ—Ç–∞ –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö",
                confidence_score=confidence,
                recommendation="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –Ω–µ–ø–æ–ª–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤—Ä—É—á–Ω—É—é"
            )

        # –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
        return False, None

    @staticmethod
    def get_rejection_message(reason: RejectionReason) -> str:
        """
        –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏

        Args:
            reason: –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è

        Returns:
            –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        """

        messages = {
            "LOW_CONFIDENCE": f"""
‚ö†Ô∏è –ù–ò–ó–ö–ê–Ø –ù–ê–î–ï–ñ–ù–û–°–¢–¨ –û–¢–í–ï–¢–ê

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ —Å–º–æ–≥ –Ω–∞–π—Ç–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–¥–µ–∂–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å
(—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ {reason.confidence_score:.0%}).

–≠—Ç–æ –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å:
‚Ä¢ –í–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
‚Ä¢ –í–∞—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–ª—É—á–∞–π –Ω–µ –æ–ø–∏—Å–∞–Ω –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –Ω–æ—Ä–º–∞—Ö
‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞

üìù –ö–ê–ö –ü–ï–†–ï–§–û–†–ú–£–õ–ò–†–û–í–ê–¢–¨ –í–û–ü–†–û–°:

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π:
‚úì "–ö–∞–∫ –ø–æ–¥–∞—Ç—å –∂–∞–ª–æ–±—É –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ –∑–∞–∫–∞–∑—á–∏–∫–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 10 –¥–Ω–µ–π?"
  (–≤–º–µ—Å—Ç–æ: "–ö–∞–∫ –æ–±–∂–∞–ª–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ?")

‚úì "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞?"
  (–≤–º–µ—Å—Ç–æ: "–ö–∞–∫–∏–µ –Ω—É–∂–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã?")

‚úì "–ö–∞–∫–æ–≤ —à—Ç—Ä–∞—Ñ –∑–∞ –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞ –≤ —Å—Ä–æ–∫ –ø–æ –ø—É–Ω–∫—Ç—É 535 –ó–†–ì–ö?"
  (–≤–º–µ—Å—Ç–æ: "–ö–∞–∫–æ–π —à—Ç—Ä–∞—Ñ –∑–∞ –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ?")

üîó –ü–û–õ–ï–ó–ù–´–ï –°–°–´–õ–ö–ò:

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /docs –¥–ª—è —Å—Å—ã–ª–æ–∫ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:
‚Ä¢ –ó–∞–∫–æ–Ω—ã: https://adilet.zan.kz/
‚Ä¢ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ Omarket: https://wiki.omarket.kz/
‚Ä¢ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ Goszakup: https://wiki.goszakup.gov.kz/

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ—Å—Ç–∞—é—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã ‚Äî –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —É–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω–æ–º—É –æ—Ä–≥–∞–Ω—É.
""",

            "CRITICAL_HALLUCINATIONS": f"""
‚ùå –û–®–ò–ë–ö–ê –í –û–¢–í–ï–¢–ï - –î–û–ö–£–ú–ï–ù–¢–´ –ù–ï –ù–ê–ô–î–ï–ù–´

–í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ —è –æ–±–Ω–∞—Ä—É–∂–∏–ª –æ—à–∏–±–∫—É.
–í –º–æ–µ–º –æ—Ç–≤–µ—Ç–µ –±—ã–ª–∏ —É–ø–æ–º—è–Ω—É—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–ª–∏ —Å—Ç–∞—Ç—å–∏ –∑–∞–∫–æ–Ω–∞,
–∫–æ—Ç–æ—Ä—ã–µ –ù–ï —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ –†–ö.

‚õî –ù–ï –ü–û–õ–ê–ì–ê–ô–¢–ï–°–¨ –ù–ê –≠–¢–û–¢ –û–¢–í–ï–¢!

–≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏, –∫–æ–≥–¥–∞:
‚Ä¢ –Ø –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª –≤–∞—à –≤–æ–ø—Ä–æ—Å
‚Ä¢ –ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ
‚Ä¢ –í–æ–ø—Ä–æ—Å –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —Ä–∞–º–∫–∏ —Å–∏—Å—Ç–µ–º—ã –≥–æ—Å–∑–∞–∫—É–ø–æ–∫ –†–ö

üîç –ß–¢–û –î–ï–õ–ê–¢–¨:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞:
   https://adilet.zan.kz/ (–æ—Å–Ω–æ–≤–Ω–æ–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ –†–ö)

2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /docs –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

3. –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≤–æ–ø—Ä–æ—Å —Å —Ç–æ—á–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞:
   ‚úì "–°–æ–≥–ª–∞—Å–Ω–æ –∫–∞–∫–æ–º—É –ø—É–Ω–∫—Ç—É –ó–†–ì–ö –ø–æ—Å—Ç–∞–≤—â–∏–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–∫–ª—é—á–µ–Ω?"
   ‚úó "–ö–∞–∫–æ–π –∑–∞–∫–æ–Ω —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –≥–æ—Å–∑–∞–∫—É–ø–∫–∏?"

4. –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ ‚Äî –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É

üìû –ö–û–ù–¢–ê–ö–¢: –£–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω—ã–π –æ—Ä–≥–∞–Ω –ø–æ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º –∑–∞–∫—É–ø–∫–∞–º –†–ö
""",

            "MULTIPLE_INTERPRETATIONS": f"""
‚ùì –ù–ï–û–î–ù–û–ó–ù–ê–ß–ù–´–ô –í–û–ü–†–û–° - –¢–†–ï–ë–£–ï–¢–°–Ø –£–¢–û–ß–ù–ï–ù–ò–ï

–í–∞—à –≤–æ–ø—Ä–æ—Å –∏–º–µ–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–π.
–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–µ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º.

–Ø –Ω–µ –º–æ–≥—É –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

üìã –£–¢–û–ß–ù–ò–¢–ï –°–õ–ï–î–£–Æ–©–ï–ï:

–í–º–µ—Å—Ç–æ "–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –ù–î–° –∫ –¥–æ–≥–æ–≤–æ—Ä—É?"
‚úì "–£ –Ω–∞—Å –µ—Å—Ç—å –¥–æ–≥–æ–≤–æ—Ä –Ω–∞ 1,000,000 —Ç–µ–Ω–≥–µ –ë–ï–ó –ù–î–°. –°—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ –ù–î–° –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ.
   –ù—É–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–∫—É–ø–∫—É –¥–ª—è –ù–î–° –∏–ª–∏ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ–≥–æ–≤–æ—Ä?"

–í–º–µ—Å—Ç–æ "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω—É–∂–Ω—ã –¥–ª—è —É—á–∞—Å—Ç–∏—è?"
‚úì "–ü–æ—Å—Ç–∞–≤—â–∏–∫ - —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ. –ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω—É–∂–Ω—ã –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –∫–æ–Ω–∫—É—Ä—Å–µ?"

–í–º–µ—Å—Ç–æ "–ö–∞–∫ –ø–æ–¥–∞—Ç—å –∂–∞–ª–æ–±—É?"
‚úì "–Ø - –ø–æ—Å—Ç–∞–≤—â–∏–∫. –ó–∞–∫–∞–∑—á–∏–∫ –≤—ã–±—Ä–∞–ª –¥—Ä—É–≥–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –Ω–µ–æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω–æ.
   –ö–∞–∫ –º–Ω–µ –ø–æ–¥–∞—Ç—å –∂–∞–ª–æ–±—É –≤ —É–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω—ã–π –æ—Ä–≥–∞–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 10 –¥–Ω–µ–π?"

üéØ –î–ï–¢–ê–õ–ò, –ö–û–¢–û–†–´–ï –ü–û–ú–û–ì–£–¢:

‚Ä¢ –í–∞—à–∞ —Ä–æ–ª—å (–∑–∞–∫–∞–∑—á–∏–∫ –∏–ª–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫?)
‚Ä¢ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –∏ —Å—É–º–º—ã
‚Ä¢ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ä–æ–∫–∏
‚Ä¢ –ö–∞–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ (Omarket –∏–ª–∏ Goszakup?)
‚Ä¢ –ö–∞–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç

–ü–æ—Å–ª–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≤–æ–ø—Ä–æ—Å –∏ —Å–ø—Ä–æ—Å–∏—Ç–µ —Å–Ω–æ–≤–∞.
""",

            "INSUFFICIENT_SOURCE_COVERAGE": f"""
üìä –ù–ï–ü–û–õ–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–ø–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ({reason.confidence_score:.0%}).

–≠—Ç–æ –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å:
‚Ä¢ –í–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –∞–∫—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Ç–æ—á–Ω–∏—Ç—å, –∫–∞–∫–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç
‚Ä¢ –í–æ–ø—Ä–æ—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏ –≥–æ—Å–∑–∞–∫—É–ø–æ–∫ –†–ö

‚úÖ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:

1Ô∏è‚É£ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ:
   ‚úì –£–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—å—é/–ø—É–Ω–∫—Ç –∑–∞–∫–æ–Ω–∞, –µ—Å–ª–∏ –≤—ã –µ–≥–æ –∑–Ω–∞–µ—Ç–µ
   ‚úì –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏–ª–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π
   ‚úì –ù–∞–∑–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (–∑–∞–∫–æ–Ω, –¥–æ–≥–æ–≤–æ—Ä, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)

2Ô∏è‚É£ –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏ —Å–ø—Ä–æ—Å–∏—Ç–µ –æ –Ω–µ–º —è–≤–Ω–æ:
   ‚úì "–°–æ–≥–ª–∞—Å–Ω–æ –ó–†–ì–ö, –∫–∞–∫–æ–π —Å—Ä–æ–∫..."
   ‚úì "–ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Omarket, –∫–∞–∫..."
   ‚úì "–í –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–º –∫–æ–¥–µ–∫—Å–µ –†–ö, –≥–¥–µ..."

3Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫:
   –ö–æ–º–∞–Ω–¥–∞ /docs –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ —Å—Å—ã–ª–∫–∏
   –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

4Ô∏è‚É£ –ï—Å–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã:
   –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —É–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω–æ–º—É –æ—Ä–≥–∞–Ω—É –ø–æ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º –∑–∞–∫—É–ø–∫–∞–º
   –∏–ª–∏ –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –≤ –æ–±–ª–∞—Å—Ç–∏ –∑–∞–∫—É–ø–æ–∫

üí° –°–û–í–ï–¢: –ß–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å - —Ç–µ–º —Ç–æ—á–Ω–µ–µ –º–æ–π –æ—Ç–≤–µ—Ç!
"""
        }

        return messages.get(reason.reason_code, str(reason.description))

    @staticmethod
    def detect_multiple_interpretations(answer: str) -> bool:
        """
        –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

        –ü—Ä–∏–∑–Ω–∞–∫–∏:
        - "–í–∞—Ä–∏–∞–Ω—Ç 1...", "–í–∞—Ä–∏–∞–Ω—Ç 2..."
        - "–í–æ–∑–º–æ–∂–Ω–æ...", "–ú–æ–∂–µ—Ç –±—ã—Ç—å..."
        - "–° –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã...", "–° –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã..."
        """

        patterns = [
            "–≤–∞—Ä–∏–∞–Ω—Ç 1",
            "–≤–∞—Ä–∏–∞–Ω—Ç 2",
            "–≤–æ–∑–º–æ–∂–Ω–æ",
            "–º–æ–∂–µ—Ç –±—ã—Ç—å",
            "—Å –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã",
            "—Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã",
            "–ª–∏–±–æ",
            "–ª–∏–±–æ",
            "–∏–ª–∏",
            "‚ö†Ô∏è –≤–∞—Ä–∏–∞–Ω—Ç",
            "–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ"
        ]

        answer_lower = answer.lower()
        variant_count = sum(1 for pattern in patterns if pattern in answer_lower)

        # –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ 3+ –ø—Ä–∏–∑–Ω–∞–∫–∞ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏ ‚Üí —ç—Ç–æ "–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏"
        return variant_count >= 3


# –ü–†–ò–ú–ï–† –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –í RAG PIPELINE
def process_answer_with_rejection(
    question: str,
    answer: str,
    validation_result: dict,  # –ò–∑ hallucination_prevention.validate_answer_for_hallucinations()
    source_chunks: list
) -> Tuple[str, bool]:
    """
    –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ

    Args:
        question: –í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        answer: –û—Ç–≤–µ—Ç –æ—Ç Claude
        validation_result: –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–∏–∑ hallucination_prevention.py)
        source_chunks: –°–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö chunks

    Returns:
        (final_answer: str, was_accepted: bool)
    """

    # –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    confidence = validation_result.get("confidence", 0.0)
    has_critical = len(validation_result.get("critical_issues", [])) > 0
    is_multiple = AnswerRejectionSystem.detect_multiple_interpretations(answer)
    source_coverage = validation_result.get("source_coverage", 0.0)

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å
    should_reject, reason = AnswerRejectionSystem.should_reject_answer(
        answer=answer,
        confidence=confidence,
        has_critical_issues=has_critical,
        is_multiple_interpretations=is_multiple,
        source_coverage=source_coverage
    )

    if should_reject:
        # –û–¢–ö–õ–û–ù–ò–¢–¨ –æ—Ç–≤–µ—Ç –∏ –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏
        rejection_message = AnswerRejectionSystem.get_rejection_message(reason)
        return rejection_message, False
    else:
        # –ü–†–ò–ù–Ø–¢–¨ –æ—Ç–≤–µ—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ, –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
        if confidence < 0.85:
            answer += f"\n\n‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≠—Ç–æ –æ—Ç–≤–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ {confidence:.0%} —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏. " \
                     f"–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω."

        return answer, True


if __name__ == "__main__":
    # –¢–ï–°–¢: –ü—Ä–∏–º–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    test_answer = """
    –°–∏—Ç—É–∞—Ü–∏—è —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –ù–î–° –∫ —É–∂–µ –∑–∞–∫–ª—é—á—ë–Ω–Ω–æ–º—É –¥–æ–≥–æ–≤–æ—Ä—É –±–µ–∑ –ù–î–°

    –í–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
    ‚ö†Ô∏è –í–∞—Ä–∏–∞–Ω—Ç 1 (–≤–µ—Ä–æ—è—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π): –ï—Å–ª–∏ –ù–î–° ‚Äî —ç—Ç–æ –Ω–æ–≤—ã–µ/–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞, —Ç–æ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –Ω–æ–≤–∞—è –∑–∞–∫—É–ø–∫–∞ (–Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç –ø–ª–∞–Ω–∞) –¥–ª—è –ù–î–°.
    ‚ö†Ô∏è –í–∞—Ä–∏–∞–Ω—Ç 2: –ï—Å–ª–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ –ù–î–° –≤ —Å–æ—Å—Ç–∞–≤–µ –ø–µ—Ä–µ–∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –±—é–¥–∂–µ—Ç–∞, –≤–æ–∑–º–æ–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—É–Ω–∫—Ç—É 2 —Å—Ç–∞—Ç—å–∏ 18 –ó–∞–∫–æ–Ω–∞.

    –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –£—Ç–æ—á–Ω–∏—Ç–µ —É –≤–∞—à–µ–≥–æ —É–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω–æ–≥–æ –æ—Ä–≥–∞–Ω–∞...
    """

    test_validation = {
        "confidence": 0.15,
        "critical_issues": [
            {"message": "–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç –ø–ª–∞–Ω–∞ –ù–ï –Ω—É–∂–µ–Ω, —ç—Ç–æ –æ–¥–Ω–∞ –∑–∞–∫—É–ø–∫–∞"},
            {"message": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –ø—É–Ω–∫—Ç–∞ 2 —Å—Ç.18 –≤ –ó–∞–∫–æ–Ω–µ"}
        ],
        "source_coverage": 0.35,
        "warnings": []
    }

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
    should_reject, reason = AnswerRejectionSystem.should_reject_answer(
        answer=test_answer,
        confidence=test_validation["confidence"],
        has_critical_issues=len(test_validation["critical_issues"]) > 0,
        is_multiple_interpretations=AnswerRejectionSystem.detect_multiple_interpretations(test_answer),
        source_coverage=test_validation["source_coverage"]
    )

    print("="*80)
    print("–¢–ï–°–¢: –ê–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞")
    print("="*80)
    print(f"\n–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –î–æ–≥–æ–≤–æ—Ä –±–µ–∑ –ù–î–° + –Ω–æ–≤—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ –ù–î–° = –Ω—É–∂–µ–Ω –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç –ø–ª–∞–Ω–∞?")
    print(f"\n–û—Ç–≤–µ—Ç –±–æ—Ç–∞ –û–¢–ö–õ–û–ù–ï–ù? {should_reject}")

    if should_reject:
        print(f"–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è: {reason.reason_code}")
        print(f"–û–ø–∏—Å–∞–Ω–∏–µ: {reason.description}")
        print(f"Confidence: {reason.confidence_score:.0%}")
        print(f"\n–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:")
        print(AnswerRejectionSystem.get_rejection_message(reason))
    else:
        print("‚ùå –û–®–ò–ë–ö–ê: –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã–ª –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω!")
